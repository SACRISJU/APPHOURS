<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>World Clock</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#111111" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#0f1220;color:#e9e9ee}
    header{padding:18px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
    h1{margin:0;font-size:18px}
    main{padding:16px;max-width:720px;margin:0 auto}
    .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);border-radius:16px;padding:14px;margin-bottom:12px}
    label{display:block;font-size:12px;opacity:.8;margin:10px 0 6px}
    select,button{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:rgba(0,0,0,.25);color:#fff}
    button{cursor:pointer;background:#2b7cff;border:none;font-weight:600}
    .grid{display:grid;grid-template-columns:1fr;gap:10px}
    .row{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-radius:12px;background:rgba(0,0,0,.22);border:1px solid rgba(255,255,255,.08)}
    .city{font-weight:600}
    .time{font-variant-numeric:tabular-nums}
    .hint{font-size:12px;opacity:.75;margin-top:8px;line-height:1.35}
  </style>
</head>
<body>
  <header>
    <h1>üïí World Clock (mini-app)</h1>
  </header>

  <main>
    <div class="card">
      <label for="tz">Elige un pa√≠s/ciudad</label>
      <select id="tz">
        <option value="America/Panama">Panam√°</option>
        <option value="America/Toronto">Canad√° (Toronto)</option>
        <option value="America/Argentina/Buenos_Aires">Argentina (Buenos Aires)</option>
        <option value="Europe/Madrid">Espa√±a (Madrid)</option>
        <option value="Europe/London">Reino Unido (Londres)</option>
        <option value="Europe/Paris">Francia (Par√≠s)</option>
        <option value="Europe/Istanbul">Turqu√≠a (Estambul)</option>
        <option value="Asia/Tokyo">Jap√≥n (Tokio)</option>
        <option value="Asia/Shanghai">China (Shangh√°i)</option>
      </select>
      <div style="height:10px"></div>
      <button id="add">A√±adir a la lista</button>
      <div class="hint">A√±ade la web a la pantalla de inicio del m√≥vil para usarla como app.</div>
    </div>

    <div class="card">
      <div id="list" class="grid"></div>
      <div class="hint">Funciona offline tras la primera carga (requiere HTTPS).</div>
    </div>
  </main>

  <script>
    const fmtTime = (tz) => new Intl.DateTimeFormat('es-ES', {
      timeZone: tz, hour: '2-digit', minute: '2-digit', second: '2-digit'
    }).format(new Date());

    const fmtDate = (tz) => new Intl.DateTimeFormat('es-ES', {
      timeZone: tz, weekday:'short', year:'numeric', month:'2-digit', day:'2-digit'
    }).format(new Date());

    const tzName = (tz) => tz.split('/').slice(-1)[0].replaceAll('_',' ');

    const listEl = document.getElementById('list');
    const selectEl = document.getElementById('tz');
    const addBtn = document.getElementById('add');

    const STORAGE_KEY = 'worldclock_tzs_v1';

    function loadTZs(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) ?? ["America/Panama","Europe/Madrid"]; }
      catch { return ["America/Panama","Europe/Madrid"]; }
    }
    function saveTZs(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

    let tzs = loadTZs();

    function render(){
      listEl.innerHTML = '';
      tzs.forEach((tz, idx) => {
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <div>
            <div class="city">${tzName(tz)}</div>
            <div style="font-size:12px;opacity:.75">${fmtDate(tz)} ‚Ä¢ ${tz}</div>
          </div>
          <div style="display:flex;gap:10px;align-items:center">
            <div class="time" data-tz="${tz}">${fmtTime(tz)}</div>
            <button style="width:auto;padding:10px 12px;background:rgba(255,255,255,.10)">‚úï</button>
          </div>
        `;
        row.querySelector('button').onclick = () => {
          tzs.splice(idx,1);
          saveTZs(tzs);
          render();
        };
        listEl.appendChild(row);
      });
    }

    function tick(){
      document.querySelectorAll('[data-tz]').forEach(el => {
        el.textContent = fmtTime(el.getAttribute('data-tz'));
      });
    }

    addBtn.onclick = () => {
      const tz = selectEl.value;
      if (!tzs.includes(tz)) {
        tzs.push(tz);
        saveTZs(tzs);
        render();
      }
    };

    render();
    tick();
    setInterval(tick, 1000);

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
</body>
</html>
